import"../chunks/DsnmJJEf.js";import{i as Et}from"../chunks/DqpBa81s.js";import{P as bt,T as dt,V as yt,U as mt,O as ht,R as St,L as Vt,M as vt,S as Nt,G as D,aP as _t,aa as gt,aO as $t,aT as tt}from"../chunks/CWkYD8mh.js";import{e as wt}from"../chunks/yfloUq0t.js";import{p as kt,i as Gt,b as Pt}from"../chunks/DAnZ61e1.js";function qt(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ct,pt;function Ht(){if(pt)return ct;pt=1;function a(s){if(this.size=s|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=s<<1;for(var t=new Array(this.size*2),r=0;r<t.length;r+=2){const d=Math.PI*r/this.size;t[r]=Math.cos(d),t[r+1]=-Math.sin(d)}this.table=t;for(var n=0,e=1;this.size>e;e<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var i=0;i<this._width;i+=2){var l=this._width-i-2;this._bitrev[o]|=(o>>>i&3)<<l}}this._out=null,this._data=null,this._inv=0}return ct=a,a.prototype.fromComplexArray=function(t,r){for(var n=r||new Array(t.length>>>1),e=0;e<t.length;e+=2)n[e>>>1]=t[e];return n},a.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var r=0;r<t.length;r++)t[r]=0;return t},a.prototype.toComplexArray=function(t,r){for(var n=r||this.createComplexArray(),e=0;e<n.length;e+=2)n[e]=t[e>>>1],n[e+1]=0;return n},a.prototype.completeSpectrum=function(t){for(var r=this._csize,n=r>>>1,e=2;e<n;e+=2)t[r-e]=t[e],t[r-e+1]=-t[e+1]},a.prototype.transform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null},a.prototype.realTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null},a.prototype.inverseTransform=function(t,r){if(t===r)throw new Error("Input and output buffers must be different");this._out=t,this._data=r,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null},a.prototype._transform4=function(){var t=this._out,r=this._csize,n=this._width,e=1<<n,o=r/e<<1,i,l,d=this._bitrev;if(o===4)for(i=0,l=0;i<r;i+=o,l++){const m=d[l];this._singleTransform2(i,m,e)}else for(i=0,l=0;i<r;i+=o,l++){const m=d[l];this._singleTransform4(i,m,e)}var u=this._inv?-1:1,f=this.table;for(e>>=2;e>=2;e>>=2){o=r/e<<1;var _=o>>>2;for(i=0;i<r;i+=o)for(var b=i+_,w=i,v=0;w<b;w+=2,v+=e){const m=w,g=m+_,p=g+_,y=p+_,x=t[m],C=t[m+1],I=t[g],M=t[g+1],z=t[p],R=t[p+1],E=t[y],S=t[y+1],V=x,c=C,h=f[v],A=u*f[v+1],T=I*h-M*A,F=I*A+M*h,B=f[2*v],N=u*f[2*v+1],$=z*B-R*N,H=z*N+R*B,W=f[3*v],U=u*f[3*v+1],K=E*W-S*U,J=E*U+S*W,Q=V+$,k=c+H,G=V-$,X=c-H,Y=T+K,P=F+J,q=u*(T-K),Z=u*(F-J),O=Q+Y,rt=k+P,et=Q-Y,nt=k-P,st=G+Z,ot=X-q,it=G-Z,at=X+q;t[m]=O,t[m+1]=rt,t[g]=st,t[g+1]=ot,t[p]=et,t[p+1]=nt,t[y]=it,t[y+1]=at}}},a.prototype._singleTransform2=function(t,r,n){const e=this._out,o=this._data,i=o[r],l=o[r+1],d=o[r+n],u=o[r+n+1],f=i+d,_=l+u,b=i-d,w=l-u;e[t]=f,e[t+1]=_,e[t+2]=b,e[t+3]=w},a.prototype._singleTransform4=function(t,r,n){const e=this._out,o=this._data,i=this._inv?-1:1,l=n*2,d=n*3,u=o[r],f=o[r+1],_=o[r+n],b=o[r+n+1],w=o[r+l],v=o[r+l+1],m=o[r+d],g=o[r+d+1],p=u+w,y=f+v,x=u-w,C=f-v,I=_+m,M=b+g,z=i*(_-m),R=i*(b-g),E=p+I,S=y+M,V=x+R,c=C-z,h=p-I,A=y-M,T=x-R,F=C+z;e[t]=E,e[t+1]=S,e[t+2]=V,e[t+3]=c,e[t+4]=h,e[t+5]=A,e[t+6]=T,e[t+7]=F},a.prototype._realTransform4=function(){var t=this._out,r=this._csize,n=this._width,e=1<<n,o=r/e<<1,i,l,d=this._bitrev;if(o===4)for(i=0,l=0;i<r;i+=o,l++){const lt=d[l];this._singleRealTransform2(i,lt>>>1,e>>>1)}else for(i=0,l=0;i<r;i+=o,l++){const lt=d[l];this._singleRealTransform4(i,lt>>>1,e>>>1)}var u=this._inv?-1:1,f=this.table;for(e>>=2;e>=2;e>>=2){o=r/e<<1;var _=o>>>1,b=_>>>1,w=b>>>1;for(i=0;i<r;i+=o)for(var v=0,m=0;v<=w;v+=2,m+=e){var g=i+v,p=g+b,y=p+b,x=y+b,C=t[g],I=t[g+1],M=t[p],z=t[p+1],R=t[y],E=t[y+1],S=t[x],V=t[x+1],c=C,h=I,A=f[m],T=u*f[m+1],F=M*A-z*T,B=M*T+z*A,N=f[2*m],$=u*f[2*m+1],H=R*N-E*$,W=R*$+E*N,U=f[3*m],K=u*f[3*m+1],J=S*U-V*K,Q=S*K+V*U,k=c+H,G=h+W,X=c-H,Y=h-W,P=F+J,q=B+Q,Z=u*(F-J),O=u*(B-Q),rt=k+P,et=G+q,nt=X+O,st=Y-Z;if(t[g]=rt,t[g+1]=et,t[p]=nt,t[p+1]=st,v===0){var ot=k-P,it=G-q;t[y]=ot,t[y+1]=it;continue}if(v!==w){var at=X,At=-Y,Ft=k,Tt=-G,Bt=-u*O,xt=-u*Z,It=-u*q,Mt=-u*P,Ct=at+Bt,Rt=At+xt,zt=Ft+Mt,Dt=Tt-It,ut=i+b-v,ft=i+_-v;t[ut]=Ct,t[ut+1]=Rt,t[ft]=zt,t[ft+1]=Dt}}}},a.prototype._singleRealTransform2=function(t,r,n){const e=this._out,o=this._data,i=o[r],l=o[r+n],d=i+l,u=i-l;e[t]=d,e[t+1]=0,e[t+2]=u,e[t+3]=0},a.prototype._singleRealTransform4=function(t,r,n){const e=this._out,o=this._data,i=this._inv?-1:1,l=n*2,d=n*3,u=o[r],f=o[r+n],_=o[r+l],b=o[r+d],w=u+_,v=u-_,m=f+b,g=i*(f-b),p=w+m,y=v,x=-g,C=w-m,I=v,M=g;e[t]=p,e[t+1]=0,e[t+2]=y,e[t+3]=x,e[t+4]=C,e[t+5]=0,e[t+6]=I,e[t+7]=M},ct}var Wt=Ht();const Ut=qt(Wt);class j{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(s){return new j(s,t=>new Float32Array(t))}static forFloat64Array(s){return new j(s,t=>new Float64Array(t))}static forNumberArray(s){return new j(s,t=>Array(t))}constructor(s,t){if(s<1)throw new Error("Input length must be at least one");this._inputLength=s,this._fft=new Ut(Qt(2*s)),this._bufferSupplier=t,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(s,t=this._bufferSupplier(s.length)){if(s.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${s.length}`);for(let n=0;n<s.length;n++)this._paddedInputBuffer[n]=s[n];for(let n=s.length;n<this._paddedInputBuffer.length;n++)this._paddedInputBuffer[n]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const r=this._transformBuffer;for(let n=0;n<r.length;n+=2)r[n]=r[n]*r[n]+r[n+1]*r[n+1],r[n+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let n=0;n<s.length;n++)t[n]=this._inverseBuffer[2*n];return t}}function Kt(a){const s=[];let t=!1,r=-1/0,n=-1;for(let e=1;e<a.length-1;e++)a[e-1]<=0&&a[e]>0?(t=!0,n=e,r=a[e]):a[e-1]>0&&a[e]<=0?(t=!1,n!==-1&&s.push(n)):t&&a[e]>r&&(r=a[e],n=e);return s}function Jt(a,s){const[t,r,n]=[a-1,a,a+1],[e,o,i]=[s[t],s[r],s[n]],l=e/2-o+i/2,d=-(e/2)*(r+n)+o*(t+n)-i/2*(t+r),u=e*r*n/2-o*t*n+i*t*r/2,f=-d/(2*l),_=l*f*f+d*f+u;return[f,_]}class L{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;_minVolumeAbsolute=0;_maxInputAmplitude=1;static forFloat32Array(s){return new L(s,t=>new Float32Array(t))}static forFloat64Array(s){return new L(s,t=>new Float64Array(t))}static forNumberArray(s){return new L(s,t=>Array(t))}constructor(s,t){this._autocorrelator=new j(s,t),this._nsdfBuffer=t(s)}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(s){if(!Number.isFinite(s)||s<=0||s>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=s}set minVolumeAbsolute(s){if(!Number.isFinite(s)||s<0||s>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=s}set minVolumeDecibels(s){if(!Number.isFinite(s)||s>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(s/10)}set maxInputAmplitude(s){if(!Number.isFinite(s)||s<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=s}findPitch(s,t){if(this._belowMinimumVolume(s))return[0,0];this._nsdf(s);const r=Kt(this._nsdfBuffer);if(r.length===0)return[0,0];const n=Math.max(...r.map(l=>this._nsdfBuffer[l])),e=r.find(l=>this._nsdfBuffer[l]>=this._clarityThreshold*n),[o,i]=Jt(e,this._nsdfBuffer);return[t/o,Math.min(i,1)]}_belowMinimumVolume(s){if(this._minVolumeAbsolute===0)return!1;let t=0;for(let r=0;r<s.length;r++)t+=s[r]**2;return Math.sqrt(t/s.length)<this._minVolumeAbsolute}_nsdf(s){this._autocorrelator.autocorrelate(s,this._nsdfBuffer);let t=2*this._nsdfBuffer[0],r;for(r=0;r<this._nsdfBuffer.length&&t>0;r++)this._nsdfBuffer[r]=2*this._nsdfBuffer[r]/t,t-=s[r]**2+s[s.length-r-1]**2;for(;r<this._nsdfBuffer.length;r++)this._nsdfBuffer[r]=0}}function Qt(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,a++,a}var Xt=bt(`<div class="intro svelte-1d9a7yg"><div class="intro-content svelte-1d9a7yg"><h1 class="svelte-1d9a7yg">welcome to eighty eight</h1> <h2 class="svelte-1d9a7yg">an interactive auditory tool that visually represents the piano's eighty eight keys</h2> <p class="svelte-1d9a7yg">long story short:<br/> when i hear music, i still see colour. <br/><br/> short story long:<br/> before i could speak in full sentences, my mum was already teaching me piano. she stuck little coloured stickers on every key of her old upright yamaha — the one she grew up with in the countrysides of hanoi — and colour-coded every note on every page of music. 
    she turned sound into something i could see, long before i understood what i was hearing. so i guess the piano became my first love. 
    like most first loves, life got in the way — and in this case, i <i>let</i> life get in the way.
    i played obsessively for years, then walked away 'for good', only to find my way back again. and again.<br/><br/> okay i see how this is starting to sound like one of those 'it's complicated' shitty situationships, but i promise it's love. just messy, stubborn, and real. <br/><br/> it's probably hard to understand, but i hope <i>eighty eight</i> at least makes it a little easier to visualise.</p> <button class="start-button svelte-1d9a7yg">see the world through my eyes by allowing mic</button></div></div>`);function Yt(a,s){let t=kt(s,"onContinue",8,()=>{});var r=Xt(),n=dt(r),e=yt(dt(n),6);mt(n),mt(r),wt("click",e,function(...o){t()?.apply(this,o)}),ht(a,r)}var Zt=bt('<canvas class="svelte-1uha8ag"></canvas> <button class="go-button svelte-1uha8ag">time to go</button>',1);function er(a,s){St(s,!1);let t=_t(!0),r=!1,n=_t(),e,o,i,l,d=new Float32Array(2048),u=[],f=null;const _={C:{r:255,g:0,b:0},D:{r:0,g:0,b:255},E:{r:255,g:165,b:0},F:{r:0,g:128,b:0},G:{r:255,g:255,b:0},A:{r:128,g:0,b:128},B:{r:255,g:192,b:203}},b=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];function w(c){return Math.round(12*Math.log2(c/440)+69)}function v(c){return b[c%12]}function m(c,h=.5){return{r:Math.round(c.r+(255-c.r)*h),g:Math.round(c.g+(255-c.g)*h),b:Math.round(c.b+(255-c.b)*h)}}function g(c,h){u.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,r:50+h*800,color:c,created:performance.now()})}function p(){D(n)&&(e=D(n).getContext("2d"),tt(n,D(n).width=window.innerWidth),tt(n,D(n).height=window.innerHeight),window.addEventListener("resize",()=>{tt(n,D(n).width=window.innerWidth),tt(n,D(n).height=window.innerHeight)}),requestAnimationFrame(I),requestAnimationFrame(C))}function y(){r||(o=new(window.AudioContext||window.webkitAudioContext),o.resume().then(async()=>{const c=await navigator.mediaDevices.getUserMedia({audio:!0});i=o.createMediaStreamSource(c),l=o.createAnalyser(),l.fftSize=d.length*2,i.connect(l),r=!0,requestAnimationFrame(x)}))}function x(){if(!l)return;l.getFloatTimeDomainData(d);const c=L.forFloat32Array(d.length),[h,A]=c.findPitch(d,o.sampleRate);if(h&&A>.8){const T=w(h),F=v(T);if(F!==f){let B=_[F[0]]||{r:255,g:255,b:255};F.length>1&&(B=m(B,.5));const N=Math.max(...d.map($=>Math.abs($)));g(B,N),f=F}}else f=null;requestAnimationFrame(x)}function C(){const c=performance.now();u=u.filter(h=>c-h.created<4e3),requestAnimationFrame(C)}function I(){if(!e)return;e.clearRect(0,0,D(n).width,D(n).height);const c=performance.now();for(let h of u){const A=c-h.created,T=Math.min(A/4e3,1);let F=A<500?A/500:1-T;const B=e.createRadialGradient(h.x,h.y,0,h.x,h.y,h.r);B.addColorStop(0,`rgba(${h.color.r},${h.color.g},${h.color.b},${F})`),B.addColorStop(1,`rgba(${h.color.r},${h.color.g},${h.color.b},0)`),e.fillStyle=B,e.beginPath(),e.arc(h.x,h.y,h.r,0,Math.PI*2),e.fill()}requestAnimationFrame(I)}async function M(){gt(t,!1),await $t(),p(),y()}function z(){const c={event:"finish",timestamp:Date.now()};console.log("GO pressed:",c),window.location.href="/byebye.html"}Et();var R=Vt(),E=vt(R);{var S=c=>{Yt(c,{onContinue:M})},V=c=>{var h=Zt(),A=vt(h);Pt(A,F=>gt(n,F),()=>D(n));var T=yt(A,2);wt("click",T,()=>z()),ht(c,h)};Gt(E,c=>{D(t)?c(S):c(V,!1)})}ht(a,R),Nt()}export{er as component};
